---
title: "AIとペアプログラミングする VSCode Extension を書きました"
topics: [vscode, ai]
emoji: 🤖
type: tech
published: true
published_at: 2025-05-06 12:00
---

- [1. 動作風景](#%E5%8B%95%E4%BD%9C%E9%A2%A8%E6%99%AF)
- [2. どんなことができるのか](#%E3%81%A9%E3%82%93%E3%81%AA%E3%81%93%E3%81%A8%E3%81%8C%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%AE%E3%81%8B)
- [3. どんな技術を使ったのか](#%E3%81%A9%E3%82%93%E3%81%AA%E6%8A%80%E8%A1%93%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%8B)
- [4. どんな人に使ってほしいのか](#%E3%81%A9%E3%82%93%E3%81%AA%E4%BA%BA%E3%81%AB%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BB%E3%81%97%E3%81%84%E3%81%AE%E3%81%8B)
- [5. 今後追加でできるといいなと思っている機能](#%E4%BB%8A%E5%BE%8C%E8%BF%BD%E5%8A%A0%E3%81%A7%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%A8%E3%81%84%E3%81%84%E3%81%AA%E3%81%A8%E6%80%9D%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E6%A9%9F%E8%83%BD)
  - [5.1. 送信タイミングの最適化](#%E9%80%81%E4%BF%A1%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AE%E6%9C%80%E9%81%A9%E5%8C%96)
  - [5.2. 送信する diff の最適化](#%E9%80%81%E4%BF%A1%E3%81%99%E3%82%8B-diff-%E3%81%AE%E6%9C%80%E9%81%A9%E5%8C%96)
  - [5.3. チャットパネルの自動スクロール](#%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%E3%83%91%E3%83%8D%E3%83%AB%E3%81%AE%E8%87%AA%E5%8B%95%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB)

[atusy/aibou.nvim](https://github.com/atusy/aibou.nvim) という AI とペアプロする Neovim プラグインがあります。（[作者さんからの紹介記事](https://blog.atusy.net/2025/04/25/aibou-nvim/)）

Visual Studio Code の [Language Model API](https://code.visualstudio.com/api/extension-guides/language-model) で、GitHub Copilot Chatで使えるLLMを利用して似たようなことができるのではと思いました。 そこで作ってみたのが [pAIr programmer](https://marketplace.visualstudio.com/items?itemName=warashi.pair-programmer) です。


# 動作風景

\![pAIr programmer を使っている様子のスクリーンショット](![](https://storage.googleapis.com/zenn-user-upload/6524adae3d30-20250506.png))


# どんなことができるのか

GitHub Copilot Chat などの Chat 形式の VSCode 拡張機能はこちらからの問いかけに応じて色々なことをしてくれますが、一方でこちらから問いかけをしないことには何もしてくれません。 pAIr programmer は、編集中のファイルの diff を自動的に LLM に渡すことで、こちらからの問いかけなしに LLM とペアプログラミングするような体験を得ることができます。 aibou.nvim とは違って送信タイミングの最適化がまだうまくできていないのですが、ある程度は似たような体験ができると思います。


# どんな技術を使ったのか

Visual Studio Code の拡張機能は TypeScript で書くことができるので、TypeScript で書きました。 また、LLM との通信には Visual Studio Code の Language Model API を利用しています。 デフォルトでは gpt-4o を利用するようになっていますが、設定を変更することでほかのモデルも利用できるようになっています。 また、LLMに渡すカスタムインストラクションも指定できるようになっているので、例えばユーザーが使っている言語を指定することで母語でのペアプログラミングをすることもできます。


# どんな人に使ってほしいのか

pAIr programmer は、有料の GitHub Copilot の権限を持っている人で、ペアプログラミングをやってみたい人におすすめです。 VSCode LM API を多用する関係で、GitHub Copilot Free を使っている人にはおすすめできません。


# 今後追加でできるといいなと思っている機能


## 送信タイミングの最適化

aibou.nvim では、ユーザーの編集速度に応じて送信タイミングを最適化する機能があるようです。 pAIr programmer でも、同様の機能を追加したいと思っています。現状は3秒間編集がなかった時もしくはファイル保存時に送信するようになっているのですが、これだとユーザーの編集速度に応じて送信タイミングを最適化することができません。


## 送信する diff の最適化

現状だと jsdiff を利用して差分を取得していますが、より効率的な方法を模索しています。 具体的には、差分の周辺のコードを同時に送信することを考えています。例えば現状だと空行を追加したり削除した際に周辺コードが送信されておらず、LLMからは空行のみの差分が見えているので、あまりいい結果が得られません。


## チャットパネルの自動スクロール

現状、チャット履歴を表示しているパネルは自動でスクロールしません。 画面からはみ出した部分は見えなくなってしまうので、自動でスクロールするようにした方が体験がいいと思っています。
